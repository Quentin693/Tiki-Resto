"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[53],{28018:(e,t,r)=>{r.d(t,{A:()=>o});var n=r(95155),a=r(12115);function o(e){let{date:t,time:r,setFormData:o,isAdmin:l=!1}=e,[i,s]=(0,a.useState)(null),[c,u]=(0,a.useState)(!1),[d,m]=(0,a.useState)(null),[h,g]=(0,a.useState)({dinner:!1}),[p,b]=(0,a.useState)(new Date);(0,a.useEffect)(()=>{b(new Date);let e=setInterval(()=>{b(new Date)},6e4);return()=>clearInterval(e)},[]),(0,a.useEffect)(()=>{if(!t)return;let[e,r,n]=t.split("-").map(Number);g({dinner:0===new Date(e,r-1,n).getDay()})},[t]),(0,a.useEffect)(()=>{t&&(async()=>{u(!0),m(null);try{let e=await fetch("".concat("https://api.votredomaine.com","/reservations/available-slots?date=").concat(t));if(!e.ok)throw Error("Erreur lors du chargement des cr\xe9neaux disponibles");let r=await e.json();s(r)}catch(e){console.error("Erreur:",e),m("Impossible de charger les cr\xe9neaux disponibles")}finally{u(!1)}})()},[t]);let x=e=>{let[r,n,a]=t.split("-").map(Number),o=new Date(r,n-1,a),l=new Date;if(l.setHours(0,0,0,0),o<l)return!0;if(o.getDate()===l.getDate()&&o.getMonth()===l.getMonth()&&o.getFullYear()===l.getFullYear()){let[t,r]=e.split(":").map(Number),n=new Date;n.setHours(t,r,0,0);let a=new Date(p);return a.setMinutes(a.getMinutes()+5),n<=a}return!1},f=e=>e<=0?"text-red-500":e<10?"text-orange-400":e<20?"text-yellow-400":"text-green-500";if(!t)return null;if(c)return(0,n.jsx)("div",{className:"text-center py-8",children:"Chargement des cr\xe9neaux disponibles..."});if(d)return(0,n.jsx)("div",{className:"text-center py-8 text-red-500",children:d});if(!i)return null;let v=(()=>{let[e,r,n]=t.split("-").map(Number);return new Date(e,r-1,n,12,0,0,0).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})(),y=h.lunch&&!l?[]:h.lunch&&l?i.lunch.map(e=>({...e,available:!1})):l?i.lunch.map(e=>({...e,available:!x(e.time)&&e.available})):i.lunch.filter(e=>e.available).map(e=>({...e,available:!x(e.time)})).filter(e=>e.available),w=h.dinner&&!l?[]:h.dinner&&l?i.dinner.map(e=>({...e,available:!1})):l?i.dinner.map(e=>({...e,available:!x(e.time)&&e.available})):i.dinner.filter(e=>e.available).map(e=>({...e,available:!x(e.time)})).filter(e=>e.available);return(0,n.jsxs)("div",{className:"bg-[#2a2a2a]/90 backdrop-blur-md rounded-xl p-8 border border-[#C4B5A2]/20 shadow-xl mb-8",children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold mb-2",children:"Horaires disponibles"}),(0,n.jsxs)("p",{className:"text-gray-400 mb-6",children:["pour le ",v]}),(0,n.jsxs)("div",{className:"space-y-8",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-3 text-[#C4B5A2]",children:"D\xe9jeuner"}),0===y.length?(0,n.jsx)("p",{className:"text-gray-400",children:h.lunch?"Le restaurant est ferm\xe9 le midi ce jour-l\xe0":"Aucun cr\xe9neau disponible pour le d\xe9jeuner"}):(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:y.map(e=>(0,n.jsxs)("button",{type:"button",onClick:()=>{console.log("Clicked lunch slot:",e),e.available&&(!h.lunch||l&&!h.lunch)&&(l?o(e.time):o(t=>({...t,time:e.time})))},disabled:!e.available||h.lunch,className:"py-3 px-4 rounded-lg text-center transition-colors ".concat(r===e.time?"bg-[#C4B5A2] text-black font-medium":e.available&&!h.lunch?"bg-[#1A1A1A] hover:bg-[#2a2a2a] text-white border border-[#C4B5A2]/30":"bg-[#1A1A1A] text-gray-500 cursor-not-allowed opacity-50 border border-[#3a3a3a]"),children:[(0,n.jsx)("div",{children:e.time}),l&&(0,n.jsx)("div",{className:"text-xs ".concat(h.lunch?"text-red-500":f(e.remainingCapacity)),children:h.lunch?"FERM\xc9":"".concat(e.remainingCapacity," / ").concat(30," places")})]},"lunch-".concat(e.time)))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium mb-3 text-[#C4B5A2]",children:"D\xeener"}),0===w.length?(0,n.jsx)("p",{className:"text-gray-400",children:h.dinner?"Le restaurant est ferm\xe9 le soir ce jour-l\xe0":"Aucun cr\xe9neau disponible pour le d\xeener"}):(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:w.map(e=>(0,n.jsxs)("button",{type:"button",onClick:()=>{console.log("Clicked dinner slot:",e),e.available&&(!h.dinner||l&&!h.dinner)&&(l?o(e.time):o(t=>({...t,time:e.time})))},disabled:!e.available||h.dinner,className:"py-3 px-4 rounded-lg text-center transition-colors ".concat(r===e.time?"bg-[#C4B5A2] text-black font-medium":e.available&&!h.dinner?"bg-[#1A1A1A] hover:bg-[#2a2a2a] text-white border border-[#C4B5A2]/30":"bg-[#1A1A1A] text-gray-500 cursor-not-allowed opacity-50 border border-[#3a3a3a]"),children:[(0,n.jsx)("div",{children:e.time}),l&&(0,n.jsx)("div",{className:"text-xs ".concat(h.dinner?"text-red-500":f(e.remainingCapacity)),children:h.dinner?"FERM\xc9":"".concat(e.remainingCapacity," / ").concat(30," places")})]},"dinner-".concat(e.time)))})]})]})]})}},17146:(e,t,r)=>{r.d(t,{AuthProvider:()=>i,h:()=>l});var n=r(95155),a=r(12115);let o=(0,a.createContext)(void 0);function l(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function i(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[i,s]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(()=>{try{let e=localStorage.getItem("user"),t=localStorage.getItem("token");e&&t&&(l(JSON.parse(e)),s(t))}catch(e){console.error("Error loading auth state from localStorage:",e)}finally{u(!1)}})()},[]);let d=async(e,t)=>{u(!0);try{console.log("Tentative de connexion pour ".concat(e));let r=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),n=await r.json();if(console.log("R\xe9ponse de l'API login:",r.status,n),!r.ok)throw Error(n.message||"Erreur lors de la connexion");if(!n.user||!n.token)throw console.error("Donn\xe9es de connexion incompl\xe8tes:",n),Error("Donn\xe9es de connexion incompl\xe8tes");return n.user.role||(console.warn('R\xf4le utilisateur non d\xe9fini, d\xe9finition par d\xe9faut \xe0 "user"'),n.user.role="user"),console.log("Utilisateur authentifi\xe9 avec r\xf4le:",n.user.role),localStorage.setItem("user",JSON.stringify(n.user)),localStorage.setItem("token",n.token),l(n.user),s(n.token),console.log("Connexion r\xe9ussie pour:",n.user.email),!0}catch(e){return console.error("Erreur de connexion:",e),!1}finally{u(!1)}},m=async(e,t,r,n)=>{u(!0);try{console.log("Tentative d'inscription pour ".concat(t));let a=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:r,phoneNumber:n})}),o=await a.json();if(console.log("R\xe9ponse de l'API inscription:",a.status,o),!a.ok)throw Error(o.message||"Erreur lors de l'inscription");if(!o.user||!o.token)throw console.error("Donn\xe9es d'inscription incompl\xe8tes:",o),Error("Donn\xe9es d'inscription incompl\xe8tes");return o.user.role||(console.warn('R\xf4le utilisateur non d\xe9fini, d\xe9finition par d\xe9faut \xe0 "user"'),o.user.role="user"),console.log("Nouvel utilisateur inscrit avec r\xf4le:",o.user.role),localStorage.setItem("user",JSON.stringify(o.user)),localStorage.setItem("token",o.token),l(o.user),s(o.token),console.log("Inscription r\xe9ussie pour:",o.user.email),!0}catch(e){return console.error("Erreur d'inscription:",e),!1}finally{u(!1)}},h=async()=>{if(!i)return!1;try{return(await fetch("/api/auth/check",{method:"GET",headers:{Authorization:"Bearer ".concat(i)}})).ok}catch(e){return console.error("Erreur lors de la v\xe9rification du token:",e),!1}},g=async()=>{if(!r||!r.email)return!1;try{let e=await fetch("/api/auth/user?email=".concat(encodeURIComponent(r.email)),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)return!1;let t=await e.json();return localStorage.setItem("user",JSON.stringify(t.user)),localStorage.setItem("token",t.token),l(t.user),s(t.token),!0}catch(e){return console.error("Erreur lors du rafra\xeechissement de la connexion:",e),!1}};return(0,n.jsx)(o.Provider,{value:{user:r,token:i,isLoading:c,isAuthenticated:!!r,login:d,register:m,logout:()=>{localStorage.removeItem("user"),localStorage.removeItem("token"),l(null),s(null),console.log("D\xe9connexion effectu\xe9e")},checkToken:h,refreshLogin:g},children:t})}}}]);