(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{61970:(e,t,s)=>{Promise.resolve().then(s.bind(s,58139))},58139:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var a=s(95155),r=s(12115),n=s(92823),i=s(84226),l=s(66889);function c(e){let{title:t,value:s,icon:r,trend:n,subtitle:i}=e,l=n.startsWith("+")?"text-green-500":"text-red-500";return(0,a.jsxs)("div",{className:"bg-[#2a2a2a] rounded-xl p-6 border border-[#C4B5A2]/30",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("div",{className:"bg-[#1a1a1a] p-3 rounded-lg",children:r}),(0,a.jsx)("span",{className:"text-sm font-medium ".concat(l),children:n})]}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-200 mb-1",children:t}),(0,a.jsx)("div",{className:"text-2xl font-bold mb-1",children:s}),i&&(0,a.jsx)("div",{className:"text-sm text-gray-400",children:i})]})}var d=s(84267),o=s(11053),m=s(40767);function u(e){let{selectedPeriod:t,setSelectedPeriod:s,notifications:n,showNotifications:i,setShowNotifications:l,markNotificationsAsRead:c}=e,u=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&l(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[l]);let x=n.filter(e=>!e.isRead).length;return(0,a.jsxs)("div",{className:"flex flex-wrap justify-between items-center mb-8 gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex rounded-lg border border-[#3a3a3a] overflow-hidden",children:[(0,a.jsx)("button",{className:"px-4 py-2 ".concat("jour"===t?"bg-[#C4B5A2] text-black":"bg-[#2a2a2a]"),onClick:()=>s("jour"),children:"Jour"}),(0,a.jsx)("button",{className:"px-4 py-2 ".concat("semaine"===t?"bg-[#C4B5A2] text-black":"bg-[#2a2a2a]"),onClick:()=>s("semaine"),children:"Semaine"}),(0,a.jsx)("button",{className:"px-4 py-2 ".concat("mois"===t?"bg-[#C4B5A2] text-black":"bg-[#2a2a2a]"),onClick:()=>s("mois"),children:"Mois"})]}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)("button",{className:"flex items-center gap-2 bg-[#2a2a2a] px-4 py-2 rounded-lg border border-[#3a3a3a]",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Filtres"})]})})]}),(0,a.jsxs)("div",{className:"relative",ref:u,children:[(0,a.jsxs)("button",{className:"relative flex items-center gap-2 bg-[#2a2a2a] px-4 py-2 rounded-lg border border-[#3a3a3a]",onClick:()=>{l(!i),!i&&c&&c()},children:[(0,a.jsx)(o.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Notifications"}),x>0&&(0,a.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:x})]}),i&&(0,a.jsx)("div",{className:"absolute right-0 mt-2 w-80 bg-[#2a2a2a] rounded-lg border border-[#3a3a3a] shadow-lg z-50",children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"font-semibold",children:"Notifications"}),(0,a.jsx)("button",{onClick:()=>l(!1),className:"text-gray-400 hover:text-white",children:(0,a.jsx)(m.A,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:0===n.length?(0,a.jsx)("p",{className:"text-gray-400 text-sm text-center",children:"Aucune notification"}):n.map(e=>(0,a.jsxs)("div",{className:"p-3 rounded-lg ".concat("urgent"===e.type?"bg-red-500/10":"bg-[#1a1a1a]"," border border-[#3a3a3a]"),children:[(0,a.jsx)("p",{className:"text-sm mb-1",children:e.message}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:e.time})]},e.id))})]})})]})]})}var x=s(58581),h=s(28064),b=s(15255),j=s(12800),g=s(66963),p=s(27112),f=s(14969);function v(e){let{reservations:t}=e,s=Array.from({length:7},(e,s)=>{let a=new Date;a.setDate(a.getDate()-s);let r=a.toISOString().split("T")[0],n=t.filter(e=>e.reservationDateTime.startsWith(r)).reduce((e,t)=>e+t.numberOfGuests,0);return{date:new Date(a).toLocaleDateString("fr-FR",{weekday:"short"}),guests:n}}).reverse();return(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(x.u,{width:"100%",height:"100%",children:(0,a.jsxs)(h.E,{data:s,children:[(0,a.jsx)(b.d,{strokeDasharray:"3 3",stroke:"#666"}),(0,a.jsx)(j.W,{dataKey:"date",stroke:"#fff"}),(0,a.jsx)(g.h,{stroke:"#fff"}),(0,a.jsx)(p.m,{contentStyle:{backgroundColor:"#2a2a2a",border:"1px solid #C4B5A2",borderRadius:"8px"},formatter:e=>["".concat(e," personnes"),"Couverts"]}),(0,a.jsx)(f.y,{dataKey:"guests",fill:"#C4B5A2",name:"Couverts"})]})})})}function N(e){let{reservations:t}=e,s=e=>{let t=[];return e.createdAt&&t.push(new Date(e.createdAt)),e.created_at&&t.push(new Date(e.created_at)),e.updatedAt&&t.push(new Date(e.updatedAt)),e.updated_at&&t.push(new Date(e.updated_at)),e.modifiedAt&&t.push(new Date(e.modifiedAt)),0===t.length&&(e.date&&e.time?t.push(new Date("".concat(e.date,"T").concat(e.time))):e.reservationDateTime?t.push(new Date(e.reservationDateTime)):(console.warn("Aucune date trouv\xe9e pour la r\xe9servation:",e.id),t.push(new Date))),new Date(Math.max(...t.map(e=>e.getTime())))},r=()=>(console.log("R\xe9servations re\xe7ues:",t),[...t].sort((e,t)=>{let a=s(e);return s(t).getTime()-a.getTime()}).slice(0,10)),n=e=>{try{if(e.date&&e.time)return new Date("".concat(e.date,"T").concat(e.time)).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"});return new Date(e.reservationDateTime).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(e){return console.error("Erreur de formatage de date",e),"Date invalide"}},i=e=>e.guests||e.numberOfGuests,l=e=>{let t=s(e),a=Math.round((new Date().getTime()-t.getTime())/6e4);return a<1?"\xc0 l'instant":a<60?"Il y a ".concat(a," min"):a<1440?"Il y a ".concat(Math.floor(a/60),"h").concat(a%60):"Il y a ".concat(Math.floor(a/1440),"j")};return(0,a.jsxs)("div",{className:"mt-8 bg-[#2a2a2a] rounded-xl p-6 border border-[#C4B5A2]/30",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-6",children:"Derni\xe8res r\xe9servations (10 plus r\xe9centes)"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-[#C4B5A2]/30",children:[(0,a.jsx)("th",{className:"text-left py-4",children:"Client"}),(0,a.jsx)("th",{className:"text-left py-4",children:"Date et Heure"}),(0,a.jsx)("th",{className:"text-left py-4",children:"Personnes"}),(0,a.jsx)("th",{className:"text-left py-4",children:"Contact"}),(0,a.jsx)("th",{className:"text-left py-4",children:"Re\xe7ue il y a"}),(0,a.jsx)("th",{className:"text-left py-4",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:0===r().length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"py-4 text-center text-gray-400",children:"Aucune r\xe9servation trouv\xe9e"})}):r().map(e=>(0,a.jsxs)("tr",{className:"border-b border-[#C4B5A2]/10",children:[(0,a.jsx)("td",{className:"py-4",children:e.customerName}),(0,a.jsx)("td",{className:"py-4",children:n(e)}),(0,a.jsx)("td",{className:"py-4",children:i(e)}),(0,a.jsx)("td",{className:"py-4",children:(0,a.jsxs)("div",{className:"text-sm text-gray-400",children:[(0,a.jsx)("div",{children:e.customerPhone}),(0,a.jsx)("div",{children:e.customerEmail})]})}),(0,a.jsx)("td",{className:"py-4",children:(0,a.jsx)("div",{className:"text-sm text-gray-400",children:l(e)})}),(0,a.jsx)("td",{className:"py-4",children:(0,a.jsx)("button",{onClick:()=>window.location.href="/reservations/".concat(e.id),className:"px-2 py-1 text-xs rounded bg-blue-500/20 text-blue-500 hover:bg-blue-500/30",children:"D\xe9tails"})})]},e.id))})]})})]})}var y=s(90076),w=s(21233);let D=0,A=e=>{if(!e.length)return null;let t=[...e].sort((e,t)=>new Date(t.reservationDateTime).getTime()-new Date(e.reservationDateTime).getTime())[0],s=(0,y.m)(new Date(t.reservationDateTime),{locale:w.fr,addSuffix:!0});return{id:++D,type:"warning",message:"Nouvelle r\xe9servation : ".concat(t.customerName," - ").concat(t.numberOfGuests," personnes"),time:s,isRead:!1}};function C(){let[e,t]=(0,r.useState)("jour"),[s,d]=(0,r.useState)(!1),[o,m]=(0,r.useState)([]),[x,h]=(0,r.useState)({dailyReservations:"0",lunchOccupancy:"0%",dinnerOccupancy:"0%"}),[b,j]=(0,r.useState)([]);(0,r.useEffect)(()=>{p();let e=setInterval(p,6e4);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{let e=A(o);e&&j(t=>{let s=t.filter(t=>t.id!==e.id);return[e,...s]})},[o]);let g=e=>{let t=new Date().toISOString().split("T")[0],s=e.filter(e=>e.reservationDateTime.startsWith(t)),a=s.filter(e=>{let t=new Date(e.reservationDateTime).getHours();return t>=11&&t<15}),r=s.filter(e=>{let t=new Date(e.reservationDateTime).getHours();return t>=18&&t<23}),n=a.reduce((e,t)=>e+t.numberOfGuests,0),i=r.reduce((e,t)=>e+t.numberOfGuests,0),l=Math.min(Math.round(n/150*100),100),c=Math.min(Math.round(i/200*100),100);h({dailyReservations:String(n+i),lunchOccupancy:"".concat(l,"%"),dinnerOccupancy:"".concat(c,"%")})},p=async()=>{try{let e=await fetch("http://localhost:3001/reservations");if(!e.ok)throw Error("Erreur lors du chargement des r\xe9servations");let t=await e.json();m(t),g(t)}catch(e){console.error("Erreur lors du chargement des r\xe9servations:",e)}};return(0,a.jsxs)("div",{className:"min-h-screen bg-[#1a1a1a] text-white",children:[(0,a.jsx)("div",{className:"bg-[#2a2a2a] border-b border-[#C4B5A2]",children:(0,a.jsx)("div",{className:"container mt-40 mx-auto px-4 py-6",children:(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Dashboard Administrateur"})})}),(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)(u,{selectedPeriod:e,setSelectedPeriod:t,notifications:b,showNotifications:s,setShowNotifications:d,markNotificationsAsRead:()=>{j(e=>e.map(e=>({...e,isRead:!0})))}}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsx)(c,{title:"R\xe9servations du jour",value:x.dailyReservations,icon:(0,a.jsx)(n.A,{className:"w-6 h-6"}),trend:"+12%",subtitle:"Total couverts"}),(0,a.jsx)(c,{title:"Taux de remplissage",value:x.lunchOccupancy,icon:(0,a.jsx)(i.A,{className:"w-6 h-6"}),trend:"".concat("0%"===x.lunchOccupancy?"0":"+").concat(x.lunchOccupancy),subtitle:"Ce midi (max 150)"}),(0,a.jsx)(c,{title:"Taux de remplissage",value:x.dinnerOccupancy,icon:(0,a.jsx)(i.A,{className:"w-6 h-6"}),trend:"".concat("0%"===x.dinnerOccupancy?"0":"+").concat(x.dinnerOccupancy),subtitle:"Ce soir (max 200)"}),(0,a.jsx)(c,{title:"En cours...",value:"0",icon:(0,a.jsx)(l.A,{className:"w-6 h-6"}),trend:"0",subtitle:"\xc0 venir"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsxs)("div",{className:"bg-[#2a2a2a] rounded-xl p-6 border border-[#C4B5A2]/30",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-6",children:"Nombre de couverts par jour"}),(0,a.jsx)(v,{reservations:o})]})}),(0,a.jsxs)("div",{className:"bg-[#2a2a2a] rounded-xl p-6 border border-[#C4B5A2]/30",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-6",children:"Informations du jour"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-[#1a1a1a] rounded-lg border border-[#C4B5A2]/20",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"\xc9v\xe9nements sp\xe9ciaux"}),(0,a.jsx)("p",{className:"text-sm text-gray-300",children:"Anniversaire table 8 (21h)"})]}),(0,a.jsxs)("div",{className:"p-4 bg-[#1a1a1a] rounded-lg border border-[#C4B5A2]/20",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Allergies signal\xe9es"}),(0,a.jsxs)("p",{className:"text-sm text-gray-300",children:["Gluten (table 4)",(0,a.jsx)("br",{}),"Fruits de mer (table 12)"]})]}),(0,a.jsxs)("div",{className:"p-4 bg-[#1a1a1a] rounded-lg border border-[#C4B5A2]/20",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Notes importantes"}),(0,a.jsxs)("p",{className:"text-sm text-gray-300",children:["Groupe de 8 personnes (19h30)",(0,a.jsx)("br",{}),"Client r\xe9gulier table 6"]})]})]})]})]}),(0,a.jsx)(N,{reservations:o})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[672,2202,8441,1517,7358],()=>t(61970)),_N_E=e.O()}]);